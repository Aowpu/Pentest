# Giới thiệu HTML
- HTML (Hyper Text Markup Language) là ngôn ngữ được sử dụng để tạo và cấu trúc các thành phần trong trang web
- HTML là khung, CSS là design, Javasript là phần động
- Browser sẽ xử lý các tag HTML và hiển thị cho người dùng.
  - Gặp `<img>` thì hiển thị hình ảnh cho người dùng.
  - Gặp `<h1>` sẽ in đậm đoạn text bên trong.
- Nhờ vào Header Content-Type là text/html thì browser sẽ render file HTML ấy
# Giới thiệu HTML Injection
- Đối tượng nào thường xuyên xử lý HTML là:
  - HTML Rendering: Browsers, Applications,…
  - HTML Editor: Rich Text Editor, Markdown (supports HTML),…
- Bản chất của Injection là khiến cho đối tượng hiểu lầm user input là Instruction
- Sẽ ra sao nếu trình duyệt xử lý untrusted HTML?  (Giải thuyết 1)
- Vậy có những instruction nào nguy hiểm của HTML ta có thể lợi dụng không? (Giải thuyết 2)
# Nguyên lý hoạt động của trình duyệt
## Tính năng chính HTML
- Cấu trúc một website.
- Tích hợp CSS.
- Tích hợp với JavaScript.
## Tính năng chính JavaScript
- Tương tác với DOM tree
  - Đọc/ thay đổi nội dung
  - Thêm/ xóa tag HTML
  - Điều hướng website
  - Tương tác với người dùng
- Gửi/nhận HTTP
  - fetch API
  - XHR / AJAX
- Lưu trữ
  - Cookie
  - Storage
  - Cache
# Giả thuyết 1
- Sẽ ra sao nếu trình duyệt xử lý untrusted HTML?
- Vậy hacker cho trình truyệt xử lý untrusted HTMl như thế nào ?
- Viễn cảnh 1 - Trực tiếp
- Khi nạn nhân vô tình vào trang web của Hacker
- Vậy trình duyệt nạn nhân có gì bí mật mà hacker muốn lấy?
  - Trình duyệt nạn nhân có thể có: Phiên đăng nhập/cookie, Storage/Mật khẩu/Token/..., Lịch sử duyệt web,...
- Chúng ta chỉ có thể tấn công khi mà cùng Origin bởi vì nếu khác Origin thì trình duyệt sẽ block chúng ta và không thể lấy dữ liệu từ web chúng ta muốn đọc trộm
-> Vậy chỉ còn một cách làm tìm những nơi mà có thể chạy những tag html bên trong chính trình duyệt đó mới có thể tấn công lừa người dùng
# Same-Origin Policy
- Trong thế giới web có SOP:
  - SOP xây những hàng rào để các website được tách biệt và chúng không thể lấy data của nhau.
  - Là bộ quy tắc để bảo vệ người dùng, tránh việc hai trang có origin khác nhau tương tác (đọc, ghi, …) với tài nguyên của nhau
- Hai URL cùng origin nếu có cùng protocol, port và host.
# Giả thuyết 2
- Sẽ ra sao nếu Untrusted Data rơi vào trong HTML của trang web cần kiểm thử thâm nhập ?
- Lúc này, ta có thể sử dụng JS để thoải mái đọc dữ liệu của trang web đó vì JS đang thực thi trên Origin của trang web đó.
# HTTP Cookie
- Cookie được dùng để duy trì trạng thái đăng nhập của user trong một website.
- Cách Cookie & Session hoạt động
![image](https://github.com/Aowpu/Pentest/assets/130723782/99e1de8e-607b-4e09-831a-d340b3e3d873)
# Tóm lại
- Root cause: Untrusted data được browser render dưới dạng HTML
- Impact: Attacker có thể khiến trình duyệt xử lý các HTML instruction
  - Attacker có khả năng chạy được JavaScript
  - Thay đổi giao diện website và thực hiện kiểu tấn công Social Engineering lên user
- Context: 
  - NoteJS: res.send(untruste_data)
  - PHP: echo untrusted_data
  - ...
