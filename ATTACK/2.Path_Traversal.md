# Path Traversal
## Path là gì ?
- Đường dẫn trong thực tế là đường đi từnơi này đến nơi khác. Còn trên máy tính đó chính là đường dẫn đểta truy cấp đến những file, thư mục được lưu trên máy tính.
## Absolute Path vs Relative Path
- Đường dẫn trên máy tính cũng được chia làm 2 loại:
  - Absolute Path (đường dẫn tuyệt đối): đường dẫn bắt đầu từ thư mục gốc và bất kì đâu đều có thể đến được.
  - Relative Path (đường dẫn tương đối): đường dẫn phụ thuộc vào vị trí hiện tại.
- Trong hệ điều hành Linux quy ước:
  - Dấu chấm(.):tượng trưng cho đường dẫn đến thư mục hiện tại
  - 2 dấu chấm(..):tượng trưng cho đường dẫn đến thư mục cha 
## Path Traversal vulnerability là gì
- Path Traversal vulnerability là một lỗ hổng web cho phép kẻ tấn công đọc các file không mong muốn trên server. Nó dẫn đến việc bị lộ thông tin nhạy cảm của ứng dụng như `thông tin đăng nhập` , `một số file` hoặc `thư mục của hệ điều hành`. Trong một số trường hợp cũng có thể ghi vào các files trên server, cho phép kẻ tấn công có thể thay đổi dữ liệu hay thậm chí là chiếm quyền điều khiển server.
## Tổng quan về lỗ hổng Path Traversal
- Root cause: Untrusted Data rơi vào những hàm xử lí đường dẫn tệp tin
- Impact: Attacker có thể thao túng được file path, phụ thuộc vào logic chương trình.
- Comtext: unreusated Data rơi vào hàm xử lí đường dẫn tệp tin.
  - PHP: Read - readfile(), Write - file_put_contents(), Delete - unlink(), RCE - include(),...
## Một số cách ngăn chặn.
- Nên validate input của người dùng trước khi xử lý nó.
- Sử dụng whitelist cho những giá trị được cho phép.
- Hoặc tên file là những kí tự số,chữ không nên chứa những ký tự đặc biệt.

## Một số bài viết tham khảo
- [Hacktricks](https://book.hacktricks.xyz/pentesting-web/file-inclusion)
- [PortSwigger](https://portswigger.net/web-security/file-path-traversal)
- [OSWAP](https://owasp.org/www-community/attacks/Path_Traversal)
- [Bảng tổng hợp cácquy ướcđường dẫn trên các hệ điều hành khác nhau](https://en.wikipedia.org/wiki/Path_(computing))
## Demo lab về lỗ hổng Path-Traversal
- Bài lab dưới đây ở phần 6 mô tả lại lỗi mà 12.7% web trên thế giới mắc phải
- [Lab Cyberjutsu](https://hackmd.io/@AowPhwc/r1hMLHspa)

## Tổng kết sau khi làm Lab
- Cách hiệu quả nhất để ngăn chặn các lỗ hổng truyền tải đường dẫn là tránh chuyển hoàn toàn dữ liệu đầu vào do người dùng cung cấp tới API hệ thống tệp.
- Sử dụng đường dẫn tuyệt đối
- Kiểm tra dữ liệu đầu vào
- Sử dụng các chỉ mục thay vì các phần thực tế của tên tệp khi tạo khuôn mẫu hoặc sử dụng tệp ngôn ngữ
- Sử dụng mã hóa

